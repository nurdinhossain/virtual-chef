<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>AR.js Button-based Animations</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">
<a-scene embedded arjs='sourceType: webcam; debugUIEnabled: false;'>
    <a-marker preset="hiro"
              smooth="true"
              smoothCount="10"
              smoothTolerance="0.01"
              smoothThreshold="5">
        <a-entity
                id="animated-model"
                gltf-model="animation1test.glb"
                scale="1.5 1.5 1.5"
                position="0 -5 3"
                rotation="0 -180 0">
        </a-entity>
    </a-marker>
    <a-entity camera></a-entity>
</a-scene>

<div style="position: absolute; bottom: 10px; left: 10px; z-index: 999;">
    <button id="button1">Step 1</button>
    <button id="button2">Step 2</button>
    <button id="button3">Step 3</button>
</div>

<script>
    const animatedModel = document.querySelector('#animated-model');
    let animations = [];
    let currentAnimation = null;

    animatedModel.addEventListener('model-loaded', function() {
        console.log('Model loaded');
        animations = animatedModel.getObject3D('mesh').animations;
        console.log('Available animations:', animations.map((a, index) => `${index}: ${a.name}`));
    });

    function playAnimation(index) {
        if (index < animations.length) {
            const clipName = animations[index].name;
            console.log(`Playing animation: ${clipName}`);

            // Remove any existing animation-mixer
            animatedModel.removeAttribute('animation-mixer');

            // Add new animation-mixer with the selected clip
            animatedModel.setAttribute('animation-mixer', {
                clip: clipName,
                loop: 'repeat',
                clampWhenFinished: true,
                timeScale: 1
            });

            currentAnimation = clipName;

            // Stop the animation after it completes one cycle
            const duration = animations[index].duration * 1000; // Convert to milliseconds
            setTimeout(() => {
                if (currentAnimation === clipName) {
                    stopAnimation();
                }
            }, duration);
        } else {
            console.log(`Animation index ${index} not found`);
        }
    }

    function stopAnimation() {
        animatedModel.removeAttribute('animation-mixer');
        currentAnimation = null;
    }

    // Set up button listeners
    document.getElementById('button1').addEventListener('click', () => playAnimation(0));
    document.getElementById('button2').addEventListener('click', () => playAnimation(1));
    document.getElementById('button3').addEventListener('click', () => playAnimation(2));
</script>
</body>
</html>